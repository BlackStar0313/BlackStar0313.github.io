"use strict";(self.webpackChunk_0313_blog=self.webpackChunk_0313_blog||[]).push([[8665],{7540:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"Unity/DOTS/ECS\u4e2d\u52a8\u6001\u66ff\u6362Material","title":"ECS\u4e2d\u52a8\u6001\u66ff\u6362Material","description":"\u95ee\u9898\u80cc\u666f","source":"@site/docs/Unity/DOTS/ECS\u4e2d\u52a8\u6001\u66ff\u6362Material.md","sourceDirName":"Unity/DOTS","slug":"/Unity/DOTS/ECS\u4e2d\u52a8\u6001\u66ff\u6362Material","permalink":"/zh-Hans/docs/Unity/DOTS/ECS\u4e2d\u52a8\u6001\u66ff\u6362Material","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Unity/DOTS/ECS\u4e2d\u52a8\u6001\u66ff\u6362Material.md","tags":[{"inline":true,"label":"Unity","permalink":"/zh-Hans/docs/tags/unity"},{"inline":true,"label":"DOTS","permalink":"/zh-Hans/docs/tags/dots"},{"inline":true,"label":"ECS","permalink":"/zh-Hans/docs/tags/ecs"},{"inline":true,"label":"Material","permalink":"/zh-Hans/docs/tags/material"}],"version":"current","frontMatter":{"title":"ECS\u4e2d\u52a8\u6001\u66ff\u6362Material","date":"2025-01-14T21:57:44.000Z","categories":["Unity","DOTS"],"tags":["Unity","DOTS","ECS","Material"]},"sidebar":"tutorialSidebar","previous":{"title":"markdown\u8bed\u6cd5\u53c2\u8003\u4ee5\u53ca\u5728Hexo\u4f7f\u7528","permalink":"/zh-Hans/docs/Blog\u76f8\u5173/markdown\u8bed\u6cd5\u53c2\u8003\u4ee5\u53ca\u5728Hexo\u4f7f\u7528"},"next":{"title":"\u5728Unity\u4e2d\u4f7f\u7528Cursor AI\u7f16\u8f91\u5668","permalink":"/zh-Hans/docs/Unity/\u5728Unity\u4e2d\u4f7f\u7528Cursor"}}');var i=a(4848),r=a(8453);const l={title:"ECS\u4e2d\u52a8\u6001\u66ff\u6362Material",date:new Date("2025-01-14T21:57:44.000Z"),categories:["Unity","DOTS"],tags:["Unity","DOTS","ECS","Material"]},s=void 0,o={},c=[{value:"\u95ee\u9898\u80cc\u666f",id:"\u95ee\u9898\u80cc\u666f",level:2},{value:"\u6a21\u578b\u7ed3\u6784\u793a\u4f8b",id:"\u6a21\u578b\u7ed3\u6784\u793a\u4f8b",level:3},{value:"Entity \u7ec4\u4ef6\u5206\u6790",id:"entity-\u7ec4\u4ef6\u5206\u6790",level:3},{value:"\u5b9e\u73b0\u65b9\u6848",id:"\u5b9e\u73b0\u65b9\u6848",level:2},{value:"1. \u7ec4\u4ef6\u5b9a\u4e49",id:"1-\u7ec4\u4ef6\u5b9a\u4e49",level:3},{value:"TankConfigAuth.cs",id:"tankconfigauthcs",level:4},{value:"TankColorChangeAuth.cs",id:"tankcolorchangeauthcs",level:4},{value:"TankColorChangeData.cs",id:"tankcolorchangedatacs",level:4},{value:"2. \u7cfb\u7edf\u5b9e\u73b0",id:"2-\u7cfb\u7edf\u5b9e\u73b0",level:3},{value:"TankChangeColorSystem.cs",id:"tankchangecolorsystemcs",level:4},{value:"\u6838\u5fc3\u5b9e\u73b0\u7ec6\u8282",id:"\u6838\u5fc3\u5b9e\u73b0\u7ec6\u8282",level:2},{value:"1. \u83b7\u53d6\u6750\u8d28 ID",id:"1-\u83b7\u53d6\u6750\u8d28-id",level:3},{value:"2. \u5b50\u5b9e\u4f53\u5904\u7406",id:"2-\u5b50\u5b9e\u4f53\u5904\u7406",level:3},{value:"3. \u6750\u8d28\u66ff\u6362",id:"3-\u6750\u8d28\u66ff\u6362",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function d(n){const e={code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"\u95ee\u9898\u80cc\u666f",children:"\u95ee\u9898\u80cc\u666f"}),"\n",(0,i.jsx)(e.p,{children:"\u5728 ECS \u67b6\u6784\u4e2d\uff0c\u5bfc\u5165\u7684\u6a21\u578b\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u6750\u8d28\u5bf9\u5e94\u4e0d\u540c\u5b50\u7f51\u683c\uff0c\u7ed3\u6784\u8f83\u4e3a\u590d\u6742\u3002\u8fd0\u884c\u65f6\u7236\u8282\u70b9\u7684 Entity \u4e0d\u5305\u542b\u6e32\u67d3\u76f8\u5173\u7684 Component\uff0c\u9700\u8981\u901a\u8fc7\u5b50 Entity \u6765\u5b9e\u73b0\u6750\u8d28\u66ff\u6362\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u6a21\u578b\u7ed3\u6784\u793a\u4f8b",children:"\u6a21\u578b\u7ed3\u6784\u793a\u4f8b"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"Unity\u7f16\u8f91\u5668\u8bbe\u7f6e",src:a(4675).A+"",width:"1895",height:"879"})}),"\n",(0,i.jsx)(e.h3,{id:"entity-\u7ec4\u4ef6\u5206\u6790",children:"Entity \u7ec4\u4ef6\u5206\u6790"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u7236\u8282\u70b9\u7ec4\u4ef6\u7ed3\u6784:"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"\u7236\u8282\u70b9\u7ec4\u4ef6",src:a(1464).A+"",width:"517",height:"1007"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5b50\u8282\u70b9\u7ec4\u4ef6\u7ed3\u6784:"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"\u5b50\u8282\u70b9\u6e32\u67d3\u7ec4\u4ef6",src:a(7761).A+"",width:"513",height:"1033"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u5b9e\u73b0\u65b9\u6848",children:"\u5b9e\u73b0\u65b9\u6848"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u7ec4\u4ef6\u5b9a\u4e49",children:"1. \u7ec4\u4ef6\u5b9a\u4e49"}),"\n",(0,i.jsx)(e.h4,{id:"tankconfigauthcs",children:"TankConfigAuth.cs"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-csharp",children:" class TankConfigAuth : MonoBehaviour\n{\n\n    public Material TankMaterial;\n\n    class TankConfigAuthBaker : Baker<TankConfigAuth>\n    {\n        public override void Bake(TankConfigAuth authoring)\n        {\n            var entity = GetEntity(TransformUsageFlags.Dynamic);\n            AddComponentObject(entity, new TankConfigColorData\n            {\n                TankMaterial = authoring.TankMaterial\n            });\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"tankcolorchangeauthcs",children:"TankColorChangeAuth.cs"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-csharp",children:"class TankColorChangeAuth : MonoBehaviour\n{\n    public GameObject TankPrefab;\n    class TankColorChangeAuthBaker : Baker<TankColorChangeAuth>\n    {\n        public override void Bake(TankColorChangeAuth authoring)\n        {\n            var entity = GetEntity(TransformUsageFlags.None);\n            AddComponent(entity, new TankColorChangeData\n            {\n                TankEntity = GetEntity(authoring.TankPrefab, TransformUsageFlags.Dynamic)\n            });\n            SetComponentEnabled<TankColorChangeData>(entity, true);\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"tankcolorchangedatacs",children:"TankColorChangeData.cs"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-csharp",children:"public struct TankColorChangeData : IComponentData, IEnableableComponent\n{\n    public Entity TankEntity;\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u7cfb\u7edf\u5b9e\u73b0",children:"2. \u7cfb\u7edf\u5b9e\u73b0"}),"\n",(0,i.jsx)(e.h4,{id:"tankchangecolorsystemcs",children:"TankChangeColorSystem.cs"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-csharp",children:"partial struct TankChangeColorSystem : ISystem\n{\n    private BatchMaterialID _batchMaterialID;\n\n    public void OnCreate(ref SystemState state)\n    {\n        state.RequireForUpdate<TankColorChangeData>();\n    }\n\n    public void OnUpdate(ref SystemState state)\n    {\n        // \u83b7\u53d6\u6750\u8d28ID\n        if (_batchMaterialID.Equals(default))\n        {\n            var configDataEntity = SystemAPI.GetSingletonEntity<TankConfigData>();\n            var materialRed = state.EntityManager.GetComponentObject<TankConfigColorData>(configDataEntity);\n            var hybridRenderer = state.World.GetOrCreateSystemManaged<EntitiesGraphicsSystem>();\n            _batchMaterialID = hybridRenderer.RegisterMaterial(materialRed.TankMaterial);\n        }\n\n        // \u5904\u7406\u5b9e\u4f53\n        var entityArray = SystemAPI.QueryBuilder().WithAll<TankColorChangeData>().Build().ToEntityArray(Allocator.TempJob);\n\n        foreach (var entity in entityArray)\n        {\n            // ... \u5b9e\u4f53\u5904\u7406\u903b\u8f91 ...\n        }\n\n        entityArray.Dispose();\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6838\u5fc3\u5b9e\u73b0\u7ec6\u8282",children:"\u6838\u5fc3\u5b9e\u73b0\u7ec6\u8282"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u83b7\u53d6\u6750\u8d28-id",children:"1. \u83b7\u53d6\u6750\u8d28 ID"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-csharp",children:"var configDataEntity = SystemAPI.GetSingletonEntity<TankConfigData>();\nvar materialRed = state.EntityManager.GetComponentObject<TankConfigColorData>(configDataEntity);\nvar hybridRenderer = state.World.GetOrCreateSystemManaged<EntitiesGraphicsSystem>();\n_batchMaterialID = hybridRenderer.RegisterMaterial(materialRed.TankMaterial);\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u5b50\u5b9e\u4f53\u5904\u7406",children:"2. \u5b50\u5b9e\u4f53\u5904\u7406"}),"\n",(0,i.jsxs)(e.p,{children:["\u901a\u8fc7 Child \u7ec4\u4ef6\u83b7\u53d6\u5b50\u8282\u70b9 Entity \u6570\u7ec4\uff0c\u904d\u5386\u5904\u7406\u6bcf\u4e2a\u5305\u542b\u6e32\u67d3\u7ec4\u4ef6\u7684\u5b9e\u4f53\uff1a\n",(0,i.jsx)(e.img,{alt:"\u5b50\u5b9e\u4f53\u7ed3\u6784",src:a(5294).A+"",width:"511",height:"167"})]}),"\n",(0,i.jsx)(e.h3,{id:"3-\u6750\u8d28\u66ff\u6362",children:"3. \u6750\u8d28\u66ff\u6362"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-csharp",children:"var meshInfo = SystemAPI.GetComponent<MaterialMeshInfo>(childEntity);\nmeshInfo.MaterialID = _batchMaterialID;\nSystemAPI.SetComponent<MaterialMeshInfo>(childEntity, meshInfo);\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5728 unmanagedWorld \u4e2d\u5b9e\u73b0 Material \u7684\u52a8\u6001\u66ff\u6362\uff0c\u901a\u8fc7\u5bf9\u5b50\u5b9e\u4f53\u7684 MaterialMeshInfo \u7ec4\u4ef6\u8fdb\u884c\u4fee\u6539\u6765\u8fbe\u5230\u76ee\u7684\u3002\u65b9\u6848\u7b80\u5355\u9ad8\u6548\uff0c\u9002\u5408\u5728 ECS \u67b6\u6784\u4e2d\u4f7f\u7528\u3002"})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},4675:(n,e,a)=>{a.d(e,{A:()=>t});const t=a.p+"assets/images/1-6d9b72291e1529a471a3d26f9949e267.png"},1464:(n,e,a)=>{a.d(e,{A:()=>t});const t=a.p+"assets/images/2-86ce00b420831d4eb0d86cb962c4c93f.png"},7761:(n,e,a)=>{a.d(e,{A:()=>t});const t=a.p+"assets/images/3-9a5820068a673910bd16b206cfa7667a.png"},5294:(n,e,a)=>{a.d(e,{A:()=>t});const t=a.p+"assets/images/4-2e5f76e9894e8b3333a9b13e2220f510.png"},8453:(n,e,a)=>{a.d(e,{R:()=>l,x:()=>s});var t=a(6540);const i={},r=t.createContext(i);function l(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:l(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);