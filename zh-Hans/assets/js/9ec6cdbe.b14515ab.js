"use strict";(self.webpackChunk_0313_blog=self.webpackChunk_0313_blog||[]).push([[5968],{3880:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"cocos/Shader\u805a\u5149\u706f\u6548\u679c","title":"Shader\u805a\u5149\u706f\u6548\u679c","description":"\u6548\u679c","source":"@site/docs/cocos/Shader\u805a\u5149\u706f\u6548\u679c.md","sourceDirName":"cocos","slug":"/cocos/Shader\u805a\u5149\u706f\u6548\u679c","permalink":"/zh-Hans/docs/cocos/Shader\u805a\u5149\u706f\u6548\u679c","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/cocos/Shader\u805a\u5149\u706f\u6548\u679c.md","tags":[{"inline":true,"label":"cocos","permalink":"/zh-Hans/docs/tags/cocos"},{"inline":true,"label":"Shader","permalink":"/zh-Hans/docs/tags/shader"}],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Shader\u805a\u5149\u706f\u6548\u679c","date":"2025-06-25T17:44:44.000Z","categories":["cocos"],"tags":["cocos","Shader"],"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"cocos","permalink":"/zh-Hans/docs/category/cocos"}}');var i=n(4848),a=n(8453);const r={title:"Shader\u805a\u5149\u706f\u6548\u679c",date:new Date("2025-06-25T17:44:44.000Z"),categories:["cocos"],tags:["cocos","Shader"],sidebar_position:1},o=void 0,c={},l=[{value:"\u6548\u679c",id:"\u6548\u679c",level:2},{value:"\u9700\u6c42",id:"\u9700\u6c42",level:2},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",level:2},{value:"1. \u5b9e\u73b0\u539f\u7406",id:"1-\u5b9e\u73b0\u539f\u7406",level:3},{value:"1. \u521b\u5efa\u4e00\u4e2aShader",id:"1-\u521b\u5efa\u4e00\u4e2ashader",level:3},{value:"2. \u521b\u5efa\u4e00\u4e2aMaterial",id:"2-\u521b\u5efa\u4e00\u4e2amaterial",level:3},{value:"3. \u4f7f\u7528\u6750\u8d28",id:"3-\u4f7f\u7528\u6750\u8d28",level:3},{value:"4. \u6dfb\u52a0ts\u811a\u672c",id:"4-\u6dfb\u52a0ts\u811a\u672c",level:3}];function d(e){const t={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components},{Details:s}=t;return s||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"\u6548\u679c",children:"\u6548\u679c"}),"\n",(0,i.jsx)(t.p,{children:"\u7531\u4e8egif\u5927\u5c0f\u9650\u5236\uff0c\u6240\u4ee5\u6548\u679c\u53ef\u80fd\u4e0d\u592a\u660e\u663e\uff0c\u5b9e\u9645\u6e10\u53d8\u6548\u679c\u6bd4\u8f83\u4e1d\u6ed1"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"\u805a\u5149\u706f\u6548\u679c",src:n(5132).A+"",width:"320",height:"692"})}),"\n",(0,i.jsx)(t.h2,{id:"\u9700\u6c42",children:"\u9700\u6c42"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"\u805a\u5149\u706f\u6548\u679c, \u6a21\u62df\u6d77\u5e95\u9ed1\u6697\u60c5\u51b5\u4e0b\u7167\u4eae\u4e00\u4e2a\u5706\u5f62\u533a\u57df"}),"\n",(0,i.jsx)(t.li,{children:"\u968f\u6d77\u5e95\u6df1\u5ea6\u53d8\u5316\uff0c\u6539\u53d8\u9ed1\u6697\u906e\u7f69\u7684\u900f\u660e\u5ea6"}),"\n",(0,i.jsx)(t.li,{children:"\u53ef\u4ee5\u8bbe\u7f6e\u805a\u5149\u706f\u7684\u8303\u56f4"}),"\n",(0,i.jsx)(t.li,{children:"\u53ef\u4ee5\u8bbe\u7f6e\u805a\u5149\u706f\u7684\u7167\u4eae\u4f4d\u7f6e"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"\u5b9e\u73b0",children:"\u5b9e\u73b0"}),"\n",(0,i.jsx)(t.h3,{id:"1-\u5b9e\u73b0\u539f\u7406",children:"1. \u5b9e\u73b0\u539f\u7406"}),"\n",(0,i.jsx)(t.p,{children:"\u6839\u636eUV\u5750\u6807\uff0c\u8ba1\u7b97\u51fa\u5f53\u524d\u50cf\u7d20\u70b9\u8ddd\u79bb\u5149\u6e90\u7684\u8ddd\u79bb\uff0c\u7136\u540e\u6839\u636e\u8ddd\u79bb\u8ba1\u7b97\u51fa\u5f53\u524d\u50cf\u7d20\u70b9\u5728\u5149\u6e90\u8303\u56f4\u5185\u7684\u989c\u8272"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"\u8d85\u51fa\u534a\u5f84\u7684\u50cf\u7d20\u70b9\u7247\u5143\u7740\u8272\u5668\u8fd4\u56de\u9ed1\u8272\uff0c"}),"\n",(0,i.jsx)(t.li,{children:"\u5728\u8303\u56f4\u5185\u7684\u50cf\u7d20\u70b9\uff0c\u6839\u636e\u8ddd\u79bb\u8ba1\u7b97\u51fa\u5f53\u524d\u50cf\u7d20\u70b9\u5728\u5149\u6e90\u8303\u56f4\u5185\u7684\u989c\u8272"}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"1-\u521b\u5efa\u4e00\u4e2ashader",children:"1. \u521b\u5efa\u4e00\u4e2aShader"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"SpotlightShader.effect"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"// assets/resources/effect/SpotlightShader.effect\nCCEffect %{\ntechniques:\n- passes:\n\t- vert: vs\n\tfrag: fs\n\tblendState:\n\t\ttargets:\n\t\t- blend: true\n\trasterizerState:\n\t\tcullMode: none\n\tproperties:\n\t\ttexture: { value: white }\n\t\tlightPosX: { value: 0.5 }\n\t\tlightPosY: { value: 0.5 }\n\t\tlightRadius: { value: 0.2 }\n\t\tdarkness: { value: 0.7 }\n\t\taspectRatio: { value: 1.0 }  // \u6dfb\u52a0aspectRatio\u5c5e\u6027\n}%\n\nCCProgram vs %{\nprecision highp float;\n#include <cc-global>\n#include <cc-local>\n\nin vec3 a_position;\nin vec2 a_uv0;\n\nout vec2 v_uv0;\n\nvoid main() {\n\tvec4 pos = vec4(a_position, 1);\n\tpos = cc_matViewProj * cc_matWorld * pos;\n\tv_uv0 = a_uv0;\n\tgl_Position = pos;\n}\n}%\n\nCCProgram fs %{\nprecision highp float;\n#include <cc-global>\n\nin vec2 v_uv0;\n\nuniform sampler2D texture;\nuniform Constant {\n\tfloat lightPosX;\n\tfloat lightPosY;\n\tfloat lightRadius;\n\tfloat darkness;\n\tfloat aspectRatio; \n};\n\nvoid main() {\n\t// \u8ba1\u7b97[0,1]\u8303\u56f4\u5185\u7684\u5f52\u4e00\u5316UV\u5750\u6807\n\tvec2 uvRect = v_uv0;\n\t\n\t// \u8ba1\u7b97\u5f53\u524d\u50cf\u7d20\u5230\u805a\u5149\u706f\u4e2d\u5fc3\u7684\u8ddd\u79bb\n\t// \u8fd9\u6837\u65e0\u8bbaUV\u5982\u4f55\u53d8\u5316\uff0c\u5149\u5708\u90fd\u4f1a\u5728sprite\u7684\u4e2d\u5fc3\n\tvec2 center = vec2(lightPosX, lightPosY);\n\t// \u7136\u540e\u5728\u8ba1\u7b97\u4e2d\u4f7f\u7528\n\tvec2 diff = v_uv0 - center;\n\tdiff.x = diff.x * aspectRatio;\n\tfloat dist = length(diff);\n\t// float dist = distance(uvRect, center);\n\t\n\t// \u8ba1\u7b97\u9ed1\u6697\u5ea6\n\tfloat alpha = darkness;\n\t\n\t// \u5982\u679c\u5728\u5149\u5708\u5185\uff0c\u51cf\u5c11\u9ed1\u6697\u5ea6\n\tif (dist < lightRadius) {\n\tfloat t = dist / lightRadius;\n\talpha = alpha * t;\n\t}\n\t\n\tgl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\n}\n}%\n"})})]}),"\n",(0,i.jsx)(t.h3,{id:"2-\u521b\u5efa\u4e00\u4e2amaterial",children:"2. \u521b\u5efa\u4e00\u4e2aMaterial"}),"\n",(0,i.jsxs)(t.p,{children:["\u7d22\u5f15\u5bf9\u5e94\u7684shader\n",(0,i.jsx)(t.img,{src:n(5431).A+"",width:"996",height:"443"})]}),"\n",(0,i.jsx)(t.h3,{id:"3-\u4f7f\u7528\u6750\u8d28",children:"3. \u4f7f\u7528\u6750\u8d28"}),"\n",(0,i.jsxs)(t.p,{children:["\u573a\u666f\u5185\u6dfb\u52a0\u4e00\u4e2asprite, \u4f7f\u7528\u5bf9\u5e94\u7684\u6750\u8d28\n",(0,i.jsx)(t.img,{src:n(2460).A+"",width:"988",height:"748"}),"\n\u7eb9\u7406\u5f15\u7528\u4e00\u4e2a\u7eaf\u767d\u8272\u7684\u56fe\u7247\u5360\u4f4d\n!!! \u6ce8\u610f\uff1a\u8fd9\u91cc\u5f15\u7528\u7684\u56fe\u4e0d\u8981\u52fe\u9009 ",(0,i.jsx)(t.code,{children:"Packable"})," ,\u5426\u5219shader \u7528\u7684\u5408\u56fe\u540e\u7684\u7eb9\u7406 uv \u53d6\u503c\u4e0d\u6b63\u786e\u3002\n",(0,i.jsx)(t.img,{src:n(935).A+"",width:"917",height:"432"})]}),"\n",(0,i.jsx)(t.h3,{id:"4-\u6dfb\u52a0ts\u811a\u672c",children:"4. \u6dfb\u52a0ts\u811a\u672c"}),"\n",(0,i.jsx)(t.p,{children:"\u63a7\u5236\u4fee\u6539shader \u7684\u53c2\u6570\uff0c\u5b9e\u73b0\u52a8\u6001\u6548\u679c"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"\tthis.material = this.darkOverlaySprite.getMaterial(0);\n\tthis.material.setProperty('darkness', 0); // \u8bbe\u7f6e\u9ed1\u6697\u5ea6\n\tthis.material.setProperty('lightRadius', 0.2); // \u8bbe\u7f6e\u5149\u5708\u534a\u5f84\n\tthis.material.setProperty('lightPosX', 0.5); // \u8bbe\u7f6e\u5149\u5708\u4e2d\u5fc3X\u5750\u6807\n\tthis.material.setProperty('lightPosY', 0.5); // \u8bbe\u7f6e\u5149\u5708\u4e2d\u5fc3Y\u5750\u6807\n\tthis.material.setProperty('aspectRatio', 1); // \u8bbe\u7f6e\u5149\u5708\u5bbd\u9ad8\u6bd4\n"})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},5132:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/giftSpotLight-3f306286dd28ce3d584ae5ad11fccbc8.gif"},2460:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/spotlight1-b1ac0c6ae998a448a32df1eb6191bffe.png"},935:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/spotlight2-38880615747cdf5df202953e9513846f.png"},5431:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/spotlightMat-24d5b7e4e3cb68f5e6121577eb8d3490.png"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(6540);const i={},a=s.createContext(i);function r(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);