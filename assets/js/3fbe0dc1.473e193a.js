"use strict";(self.webpackChunk_0313_blog=self.webpackChunk_0313_blog||[]).push([[7175],{4730:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Unity/Shader/\u793a\u4f8b\u4e4b\u989c\u8272\u5206\u7ea7","title":"\u793a\u4f8b\u4e4b\u989c\u8272\u5206\u7ea7","description":"\u6548\u679c\u56fe","source":"@site/docs/Unity/Shader/\u793a\u4f8b\u4e4b\u989c\u8272\u5206\u7ea7.md","sourceDirName":"Unity/Shader","slug":"/Unity/Shader/\u793a\u4f8b\u4e4b\u989c\u8272\u5206\u7ea7","permalink":"/docs/Unity/Shader/\u793a\u4f8b\u4e4b\u989c\u8272\u5206\u7ea7","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Unity/Shader/\u793a\u4f8b\u4e4b\u989c\u8272\u5206\u7ea7.md","tags":[],"version":"current","sidebarPosition":1023,"frontMatter":{"title":"\u793a\u4f8b\u4e4b\u989c\u8272\u5206\u7ea7","date":"2025-04-15T16:21:44.000Z","categories":["Unity","Shader"],"sidebar_position":1023},"sidebar":"tutorialSidebar","previous":{"title":"\u793a\u4f8b\u4e4bRenderFeature\u5b9e\u73b0\u8fb9\u7f18\u68c0\u6d4b\u63cf\u8fb9","permalink":"/docs/Unity/Shader/\u793a\u4f8b\u4e4bRenderFeature\u5b9e\u73b0\u8fb9\u7f18\u68c0\u6d4b\u63cf\u8fb9"},"next":{"title":"\u5404\u79cd\u5de5\u5177","permalink":"/docs/Unity/\u5404\u79cd\u5de5\u5177"}}');var a=n(4848),l=n(8453);const o={title:"\u793a\u4f8b\u4e4b\u989c\u8272\u5206\u7ea7",date:new Date("2025-04-15T16:21:44.000Z"),categories:["Unity","Shader"],sidebar_position:1023},i=void 0,s={},d=[{value:"\u6548\u679c\u56fe",id:"\u6548\u679c\u56fe",level:2},{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",level:2},{value:"\u5b9e\u73b0\u601d\u8def",id:"\u5b9e\u73b0\u601d\u8def",level:2},{value:"\u5168\u90e8\u4ee3\u7801",id:"\u5168\u90e8\u4ee3\u7801",level:2}];function u(t){const e={code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,l.R)(),...t.components},{Details:r}=e;return r||function(t,e){throw new Error("Expected "+(e?"component":"object")+" `"+t+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h2,{id:"\u6548\u679c\u56fe",children:"\u6548\u679c\u56fe"}),"\n",(0,a.jsx)("div",{align:"center",children:(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"\u6548\u679c",src:n(2059).A+"",width:"640",height:"244"})})}),"\n",(0,a.jsx)(e.h2,{id:"\u4ecb\u7ecd",children:"\u4ecb\u7ecd"}),"\n",(0,a.jsx)(e.p,{children:"\u8fd9\u4e2a\u6548\u679c\u662f\u5bf9\u753b\u9762\u8fdb\u884c\u989c\u8272\u5206\u7ea7\uff0c\u53ef\u4ee5\u6539\u53d8\u4eae\u5ea6\uff0c\u5bf9\u6bd4\u5ea6\uff0c\u9971\u548c\u5ea6\uff0c\u8272\u6e29\u7b49\u3002"}),"\n",(0,a.jsx)(e.p,{children:"\u662f\u5bf9\u4e8e\u753b\u9762\u7684\u4e00\u79cd\u827a\u672f\u5904\u7406\uff0c\u53ef\u4ee5\u6539\u53d8\u753b\u9762\u7684\u8272\u8c03\uff0c\u589e\u52a0\u753b\u9762\u7684\u827a\u672f\u611f\u3002"}),"\n",(0,a.jsx)(e.p,{children:"\u8c03\u6574\u4eae\u90e8\uff0c\u6697\u90e8\uff0c\u4e2d\u95f4\u8c03\u7684\u989c\u8272\uff0c\u5e76\u5e73\u6ed1\u8fc7\u5ea6\u3002"}),"\n",(0,a.jsx)(e.h2,{id:"\u5b9e\u73b0\u601d\u8def",children:"\u5b9e\u73b0\u601d\u8def"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsx)(e.li,{children:"\u521b\u5efa\u4e00\u4e2aVolume\u7ec4\u4ef6\uff0c\u6765\u63a7\u5236\u5916\u90e8\u4e0eShader\u7684\u5c5e\u6027\u4ea4\u4e92\u3002"}),"\n",(0,a.jsx)(e.li,{children:"\u521b\u5efa\u4e00\u4e2aRenderPass\uff0c \u5e76\u8bbe\u7f6eRenderPass\u7684\u6e32\u67d3\u987a\u5e8f"}),"\n",(0,a.jsx)(e.li,{children:"\u521b\u5efa\u4e00\u4e2aShader, \u5728Shader\u4e2d\u5b9e\u73b0\u989c\u8272\u5206\u7ea7 \u5173\u952e\u7684\u6e32\u67d3\u4ee3\u7801"}),"\n",(0,a.jsx)(e.li,{children:"\u5728Render Asset\u4e2d\u6dfb\u52a0RendererData,renderData\u6dfb\u52a0 \u8be5RenderFeature"}),"\n",(0,a.jsx)(e.li,{children:"\u6444\u50cf\u673a\u9009\u62e9RenderData ."}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"\u5168\u90e8\u4ee3\u7801",children:"\u5168\u90e8\u4ee3\u7801"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"ColorGradingFeature.cs"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing UnityEngine.Rendering;\nusing UnityEngine.Rendering.Universal;\n\npublic class ColorGradingFeature : ScriptableRendererFeature\n{\n    [SerializeField]\n    private Shader m_Shader;\n\n    private Material m_Material;\n\n    private ColorGradingPass m_ColorGradingPass;\n\n    public override void Create()\n    {\n        if (m_Shader == null)\n        {\n            Debug.LogError("Shader is not assigned");\n            return;\n        }\n\n        m_Material = new Material(m_Shader);\n\n        m_ColorGradingPass = new ColorGradingPass();\n        m_ColorGradingPass.Init(m_Material);\n    }\n\n    public override void AddRenderPasses(ScriptableRenderer renderer, ref RenderingData renderingData)\n    {\n        var volume = VolumeManager.instance.stack.GetComponent<ColorGradingVolumeComponent>();\n        if (!volume.IsActive())\n        {\n            return;\n        }\n\n        SetupRenderPasses(renderer, renderingData);\n        renderer.EnqueuePass(m_ColorGradingPass);\n    }\n\n    public override void SetupRenderPasses(ScriptableRenderer renderer, in RenderingData renderingData)\n    {\n        m_ColorGradingPass.SetUp();\n    }\n\n    protected override void Dispose(bool disposing)\n    {\n        if (Application.isPlaying)\n        {\n            Object.Destroy(m_Material);\n        }\n        else\n        {\n            Object.DestroyImmediate(m_Material);\n        }\n    }\n}\n\n'})})]}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"ColorGradingPass.cs"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing UnityEngine.Rendering;\nusing UnityEngine.Rendering.RenderGraphModule;\nusing UnityEngine.Rendering.Universal;\n\npublic class ColorGradingPass : ScriptableRenderPass\n{\n    private class CustomPassData\n    {\n        internal TextureHandle SrcColor;\n        internal Material OverridMaterial;\n    }\n\n    private Material m_Material;\n\n    public void Init(Material material)\n    {\n        m_Material = material;\n        profilingSampler = new ProfilingSampler("ColorGradingPass");\n        renderPassEvent = RenderPassEvent.BeforeRenderingPostProcessing;\n    }\n\n    public void SetUp()\n    {\n        var volume = VolumeManager.instance.stack.GetComponent<ColorGradingVolumeComponent>();\n\n        if (volume != null && volume.IsActive())\n        {\n            m_Material.SetFloat("_Brightness", volume.Brightness.value);\n            m_Material.SetFloat("_Contrast", volume.Contrast.value);\n            m_Material.SetFloat("_Saturation", volume.Saturation.value);\n            m_Material.SetFloat("_Temperature", volume.Temperature.value);\n            m_Material.SetFloat("_Tint", volume.Tint.value);\n            m_Material.SetColor("_ShadowsColor", volume.ShadowsColor.value);\n            m_Material.SetColor("_MidtonesColor", volume.MidtonesColor.value);\n            m_Material.SetColor("_HighlightsColor", volume.HighlightsColor.value);\n        }\n    }\n\n    public void Dispose() { }\n\n    public override void RecordRenderGraph(RenderGraph renderGraph, ContextContainer frameData)\n    {\n        using (var builder = renderGraph.AddRasterRenderPass<CustomPassData>(passName, out CustomPassData data))\n        {\n            UniversalResourceData resourceData = frameData.Get<UniversalResourceData>();\n            UniversalCameraData cameraData = frameData.Get<UniversalCameraData>();\n\n            data.SrcColor = resourceData.activeColorTexture;\n            data.OverridMaterial = m_Material;\n\n            builder.SetRenderAttachment(resourceData.activeColorTexture, 0, AccessFlags.ReadWrite);\n            builder.SetRenderFunc<CustomPassData>(\n                (CustomPassData data, RasterGraphContext context) => ExecutePass(data, context)\n            );\n        }\n    }\n\n    private void ExecutePass(CustomPassData data, RasterGraphContext context)\n    {\n        Blitter.BlitTexture(context.cmd, data.SrcColor, new Vector4(1, 1, 0, 0), data.OverridMaterial, 0);\n    }\n}\n\n'})})]}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"ColorGradingVolumeComponent.cs"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'using System;\nusing UnityEngine;\nusing UnityEngine.Rendering;\n\n[Serializable, VolumeComponentMenu("Custom/ColorGrading")]\npublic class ColorGradingVolumeComponent : VolumeComponent\n{\n    public BoolParameter m_EnableColorGrading = new BoolParameter(false);\n\n    //\u57fa\u7840\u989c\u8272\u8c03\u6574\n    public ClampedFloatParameter Brightness = new ClampedFloatParameter(0.0f, -1.0f, 1.0f);\n    public ClampedFloatParameter Contrast = new ClampedFloatParameter(0f, -1.0f, 1.0f);\n    public ClampedFloatParameter Saturation = new ClampedFloatParameter(0f, -1f, 1f);\n\n    //\u8272\u6e29\u8c03\u6574\n    public ClampedFloatParameter Temperature = new ClampedFloatParameter(0f, -1f, 1f);\n    public ClampedFloatParameter Tint = new ClampedFloatParameter(0f, -1f, 1f);\n\n    // \u8272\u5f69\u5e73\u8861\uff08\u5206\u8272\u6761\u63a7\u5236)\n    public ColorParameter ShadowsColor = new ColorParameter(Color.gray);\n    public ColorParameter MidtonesColor = new ColorParameter(Color.gray);\n    public ColorParameter HighlightsColor = new ColorParameter(Color.gray);\n\n    public bool IsActive()\n    {\n        return m_EnableColorGrading.value;\n    }\n}\n\n'})})]}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"ColorGrading.shader"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'Shader "Custom/ColorGrading"\n{\n\tProperties\n\t{\n\t\t_Brightness ("Brightness", Range(-1, 1)) = 0 // \u4eae\u5ea6\n\t\t_Contrast ("Contrast", Range(-1, 1)) = 0 // \u5bf9\u6bd4\u5ea6\n\t\t_Saturation ("Saturation", Range(-1, 1)) = 0 // \u9971\u548c\u5ea6\n\t}\n\n\tSubShader\n\t{\n\t\tTags { "RenderType" = "Opaque" "RenderPipeline" = "UniversalPipeline"}\n\n\t\tPass\n\t\t{\n\t\t\tName "ColorGrading"\n\n\t\t\tHLSLPROGRAM\n\t\t\t#pragma vertex Vert\n\t\t\t#pragma fragment frag \n\n\t\t\t#include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"\n\t\t\t#include "Packages/com.unity.render-pipelines.core/Runtime/Utilities/Blit.hlsl"\n\n\t\t\t \n\t\t\tCBUFFER_START(UnityPerMaterial)\n\t\t\t\tfloat _Brightness;\n\t\t\t\tfloat _Contrast;\n\t\t\t\tfloat _Saturation;\n\t\t\t\tfloat _Temperature;\n\t\t\t\tfloat _Tint;\n\t\t\t\tfloat4 _ShadowsColor;\n\t\t\t\tfloat4 _MidtonesColor;\n\t\t\t\tfloat4 _HighlightsColor;\n\t\t\tCBUFFER_END\n\n\t\t\thalf3 ApplyBrightness(half3 color , float brightness)\n\t\t\t{\n\t\t\t\treturn color + brightness;\n\t\t\t}\n\n\t\t\thalf3 ApplyContrast(half3 color , float contrast)\n\t\t\t{\n\t\t\t\treturn lerp(half3(0.5, 0.5, 0.5), color, contrast + 1.0);\n\t\t\t}\n\n\t\t\thalf3 ApplySaturation(half3 color , float saturation)\n\t\t\t{\n\t\t\t\thalf luminance = dot(color, half3(0.299, 0.587, 0.114));\n\t\t\t\treturn lerp(luminance, color, saturation);\n\t\t\t}\n\n\t\t\thalf3 ApplyTemperature(half3 color , float temperature)\n\t\t\t{\n\t\t\t\t//\u7b80\u5355\u7684\u8272\u6e29\u8c03\u8282 \uff08\u6e29\u5ea6/\u51b7\u8272\u504f\u79fb\n\t\t\t\thalf3 warm  = half3(1.0, 1.0, 1.0);   //\u6696\u8272\n\t\t\t\thalf3 cool = half3(0.0, 0.0, 0.0);   //\u51b7\u8272\n\t\t\t\t\n\t\t\t\treturn color * lerp(cool, warm, temperature * 0.5 + 0.5);\n\t\t\t}\n\n\t\t\t// \u5206\u8272\u8c03\u6574\uff08\u9634\u5f71\uff0c\u4e2d\u95f4\u8c03\uff0c\u9ad8\u5149\uff09\n\t\t\thalf3 ApplyColorBalance(half3 color, half3 shadows, half3 midtones, half3 highlights)\n\t\t\t{\n\t\t\t\tfloat luminance = dot(color, half3(0.2126, 0.7152, 0.0722));\n\n\t\t\t\t//\u5206\u7c7b\n\t\t\t\tfloat shadowsWeight = 1.0 - smoothstep(0.0, 0.33, luminance);\n\t\t\t\tfloat highlightWeight = smoothstep(0.66, 1.0, luminance);\n\t\t\t\tfloat midtonesWeight = 1.0 - shadowsWeight - highlightWeight;\n\n\t\t\t\t// \u6df7\u5408\u7ed3\u679c\n\t\t\t\thalf3 result = color ;\n\t\t\t\tresult *= lerp(half3(1,1,1), shadows , shadowsWeight);\n\t\t\t\tresult *= lerp(half3(1,1,1), midtones, midtonesWeight);\n\t\t\t\tresult *= lerp(half3(1,1,1), highlights, highlightWeight);\n\t\t\t\t\n\t\t\t\treturn result;\n\t\t\t}\n\n\n\t\t\thalf4 frag(Varyings input) : SV_Target\n\t\t\t{\n\t\t\t\thalf4 baseColor = SAMPLE_TEXTURE2D(_BlitTexture, sampler_LinearClamp, input.texcoord);\n\n\t\t\t\t// \u4f9d\u6b21\u5e94\u7528\u5404\u79cd\u989c\u8272\u8c03\u6574\n\t\t\t\thalf3 result = baseColor.rgb ;\n\t\t\t\tresult = ApplyBrightness(result, _Brightness);\n\t\t\t\tresult = ApplyContrast(result, _Contrast);\n\t\t\t\tresult = ApplySaturation(result, _Saturation);\n\t\t\t\tresult = ApplyTemperature(result, _Temperature);\n\t\t\t\tresult = ApplyColorBalance(result, _ShadowsColor.rgb, _MidtonesColor.rgb, _HighlightsColor.rgb\t);\n\n\t\t\t\treturn half4(result, baseColor.a);\n\t\t\t}\n\t\t\tENDHLSL\n\t\t}\n\t}\n}\n'})})]})]})}function c(t={}){const{wrapper:e}={...(0,l.R)(),...t.components};return e?(0,a.jsx)(e,{...t,children:(0,a.jsx)(u,{...t})}):u(t)}},2059:(t,e,n)=>{n.d(e,{A:()=>r});const r=n.p+"assets/images/colorGrading-f101578a1a38167bd1417d2542700b3d.gif"},8453:(t,e,n)=>{n.d(e,{R:()=>o,x:()=>i});var r=n(6540);const a={},l=r.createContext(a);function o(t){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function i(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(a):t.components||a:o(t.components),r.createElement(l.Provider,{value:e},t.children)}}}]);