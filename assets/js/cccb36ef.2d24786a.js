"use strict";(self.webpackChunk_0313_blog=self.webpackChunk_0313_blog||[]).push([[5180],{30352:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"cocos/Shader\u7eb9\u7406\u4fdd\u6301\u4eae\u5ea6\u6e10\u53d8\u989c\u8272","title":"Shader\u7eb9\u7406\u4fdd\u6301\u4eae\u5ea6\u6e10\u53d8\u989c\u8272","description":"\u6548\u679c","source":"@site/docs/cocos/Shader\u7eb9\u7406\u4fdd\u6301\u4eae\u5ea6\u6e10\u53d8\u989c\u8272.md","sourceDirName":"cocos","slug":"/cocos/Shader\u7eb9\u7406\u4fdd\u6301\u4eae\u5ea6\u6e10\u53d8\u989c\u8272","permalink":"/docs/cocos/Shader\u7eb9\u7406\u4fdd\u6301\u4eae\u5ea6\u6e10\u53d8\u989c\u8272","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/cocos/Shader\u7eb9\u7406\u4fdd\u6301\u4eae\u5ea6\u6e10\u53d8\u989c\u8272.md","tags":[{"inline":true,"label":"cocos","permalink":"/docs/tags/cocos"},{"inline":true,"label":"Shader","permalink":"/docs/tags/shader"}],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Shader\u7eb9\u7406\u4fdd\u6301\u4eae\u5ea6\u6e10\u53d8\u989c\u8272","date":"2025-08-28T20:36:00.000Z","categories":["cocos"],"tags":["cocos","Shader"],"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Shader\u91d1\u8272\u63cf\u8fb9","permalink":"/docs/cocos/Shader\u91d1\u8272\u63cf\u8fb9"},"next":{"title":"\u6027\u80fd\u4f18\u5316\u4e4bDrawCall","permalink":"/docs/cocos/\u6027\u80fd\u4f18\u5316\u4e4bDrawCall"}}');var s=n(74848),i=n(28453);const a={title:"Shader\u7eb9\u7406\u4fdd\u6301\u4eae\u5ea6\u6e10\u53d8\u989c\u8272",date:new Date("2025-08-28T20:36:00.000Z"),categories:["cocos"],tags:["cocos","Shader"],sidebar_position:4},o=void 0,c={},l=[{value:"\u6548\u679c",id:"\u6548\u679c",level:2},{value:"\u9700\u6c42",id:"\u9700\u6c42",level:2},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",level:2},{value:"\u5177\u4f53\u64cd\u4f5c",id:"\u5177\u4f53\u64cd\u4f5c",level:2},{value:"1. \u5199\u91c7\u6837\u7528\u7684shader",id:"1-\u5199\u91c7\u6837\u7528\u7684shader",level:3},{value:"2. \u521b\u5efa\u4e00\u4e2aMaterial",id:"2-\u521b\u5efa\u4e00\u4e2amaterial",level:3},{value:"3. \u4f7f\u7528\u6750\u8d28",id:"3-\u4f7f\u7528\u6750\u8d28",level:3},{value:"4. \u4f7f\u7528\u811a\u672c\u63a7\u5236",id:"4-\u4f7f\u7528\u811a\u672c\u63a7\u5236",level:3}];function d(e){const t={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:r}=t;return r||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"\u6548\u679c",children:"\u6548\u679c"}),"\n",(0,s.jsx)("p",{align:"center",children:(0,s.jsx)("img",{src:n(37442).A,style:{width:200}})}),"\n",(0,s.jsx)(t.h2,{id:"\u9700\u6c42",children:"\u9700\u6c42"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u8f6c\u76d8\u6e38\u620f\uff0c\u6e38\u620f\u4e2d\u6709\u4e2a\u84dd\u8272\u7684\u80cc\u666f\uff0c\u7f8e\u672f\u5e0c\u671b\u5728\u5f97\u5230\u5927\u5956\u540e\uff0c\u80cc\u666f\u989c\u8272\u4ece\u84dd\u8272\u6e10\u53d8\u5230\u91d1\u8272\u3002"}),"\n",(0,s.jsx)(t.li,{children:"\u76f4\u63a5\u4fee\u6539\u56fe\u7247\u7684\u989c\u8272\uff0c\u6253\u4e0d\u5230\u6548\u679c\uff0c\u800c\u4e14\u5e0c\u671b\u6e10\u53d8\u5f0f\u7684\u6539\u53d8\u5230\u5bf9\u5e94\u989c\u8272\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"\u8fd9\u91cc\u662f\u7f8e\u672f\u51fa\u7684\u6548\u679c\u56fe \u84dd\u8272\u539f\u59cb\u56fe\u548c\u91d1\u8272\u6e10\u53d8\u56fe"}),"\n",(0,s.jsxs)("p",{align:"center",children:[(0,s.jsx)("img",{src:n(51909).A,style:{width:200}}),(0,s.jsx)("img",{src:n(81550).A,style:{width:200}})]}),"\n",(0,s.jsx)(t.h2,{id:"\u5b9e\u73b0",children:"\u5b9e\u73b0"}),"\n",(0,s.jsx)(t.p,{children:"\u601d\u8def\u4e3a\uff1a"}),"\n",(0,s.jsx)(t.p,{children:"\u5982\u679c\u76f4\u63a5\u5728\u7247\u5143\u7740\u8272\u5668\u4e2d\uff0c\u91c7\u6837\u539f\u59cb\u7eb9\u7406\uff0c\u76f4\u63a5\u7ed9\u539f\u50cf\u7d20\u70b9\u6dfb\u52a0\u4e00\u4e2a\u8272\u503c\uff0c\u4f1a\u5bfc\u81f4\u7eb9\u7406\u53e0\u989c\u8272\u540e\u6574\u4e2a\u7cca\u5230\u4e00\u8d77\u4e86\uff0c\u611f\u89c9\u60f3\u6574\u4e2a\u56fe\u7247\u4e0a\u8499\u4e86\u4e00\u5c42\u989c\u8272\u3002"}),"\n",(0,s.jsx)(t.p,{children:"\u6b63\u786e\u7684\u5e94\u8be5\u662f\u4fdd\u6301\u539f\u7eb9\u7406\u4e2d\u50cf\u7d20\u70b9\u7684\u4eae\u5ea6\uff0c\u7136\u540e\u6539\u53d8\u8272\u76f8\u548c\u9971\u548c\u5ea6\u3002\u8fd9\u6837\u770b\u8d77\u6765\u80cc\u666f\u91cc\u753b\u7684\u5185\u5bb9\u90fd\u548c\u539f\u56fe\u4e00\u6837\u4fdd\u6301\u6e05\u6670\uff0c\u6574\u4f53\u9971\u548c\u5ea6\u8272\u76f8\u53d8\u6210\u4e86\u522b\u7684\u989c\u8272\u3002"}),"\n",(0,s.jsx)(t.p,{children:"\u6700\u540e\u7531\u4e8e\u76ee\u6807\u989c\u8272\u66f4\u4eae\u4e00\u70b9\uff0c\u6700\u540e\u518d\u627e\u4e00\u4e2a\u53c2\u6570\u8ba9\u6574\u4f53\u4eae\u5ea6\u518d\u4eae\u4e00\u70b9\uff0c\u80fd\u6709\u66f4\u6696\u7684\u6548\u679c\u3002"}),"\n",(0,s.jsx)(t.h2,{id:"\u5177\u4f53\u64cd\u4f5c",children:"\u5177\u4f53\u64cd\u4f5c"}),"\n",(0,s.jsx)(t.h3,{id:"1-\u5199\u91c7\u6837\u7528\u7684shader",children:"1. \u5199\u91c7\u6837\u7528\u7684shader"}),"\n",(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:"TintOverlay.effect"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"// TintOverlay.effect - \u6e10\u53d8\u8fc7\u7a0b\u5f0f\u7684\u53e0\u52a0\u989c\u8272\u6548\u679c\nCCEffect %{\ntechniques:\n- passes:\n- vert: vs\n  frag: fs\n  blendState:\n    targets:\n    - blend: true\n  rasterizerState:\n    cullMode: none\n  properties:\n    texture: { value: white }\n    overlayColor: { value: [1.0, 0.6, 0.0, 1.0], editor: { type: color } }\n    progress: { value: 0.0 }\n    brightness: { value: 1.25 }   // \u65b0\u589e\n}%\n\nCCProgram vs %{\nprecision highp float;\n#include <cc-global>\n#include <cc-local>\n\nin vec3 a_position;\nin vec2 a_uv0;\nin vec4 a_color;\n\nout vec2 v_uv0;\nout vec4 v_color;\n\nvoid main () {\nvec4 pos = vec4(a_position, 1.0);\n#if CC_USE_MODEL\n  pos = cc_matViewProj * cc_matWorld * pos;\n#else\n  pos = cc_matViewProj * pos;\n#endif\nv_uv0 = a_uv0;\nv_color = a_color;\ngl_Position = pos;\n}\n}%\n\nCCProgram fs %{\nprecision highp float;\n#include <alpha-test>\n\nin vec2 v_uv0;\nin vec4 v_color;\nuniform sampler2D texture;\n\nuniform ARGS {\nvec4 overlayColor;\nfloat progress;\nfloat brightness;   // \u65b0\u589e\nfloat _pad0;\n};\n\nvoid main () {\nvec4 base = texture(texture, v_uv0);\nfloat k = clamp(progress, 0.0, 1.0) * clamp(overlayColor.a, 0.0, 1.0);\n\n// \u4fdd\u7559\u539f\u56fe\u4eae\u5ea6\uff08luminance\uff09\uff0c\u4f7f\u7528\u53e0\u52a0\u989c\u8272\u7684\u8272\u76f8/\u9971\u548c\u5ea6\nconst vec3 LUMA = vec3(0.2126, 0.7152, 0.0722);\nfloat L  = dot(base.rgb, LUMA);\nfloat Lo = max(dot(overlayColor.rgb, LUMA), 1e-4);\n\nvec3 colorized = overlayColor.rgb * (L / Lo) * brightness; // \u4fdd\u4eae\u5ea6\u5e76\u589e\u76ca\n// \u5728\u539f\u56fe\u4e0e\u201c\u4fdd\u4eae\u5ea6\u7684\u7740\u8272\u201d\u4e4b\u95f4\u63d2\u503c\nvec3 rgb = mix(base.rgb, clamp(colorized, 0.0, 1.0), k);\ngl_FragColor = vec4(rgb, base.a) * v_color;\n}\n}%\n"})})]}),"\n",(0,s.jsx)(t.h3,{id:"2-\u521b\u5efa\u4e00\u4e2amaterial",children:"2. \u521b\u5efa\u4e00\u4e2aMaterial"}),"\n",(0,s.jsx)(t.p,{children:"\u7d22\u5f15\u5bf9\u5e94\u7684shader"}),"\n",(0,s.jsx)(t.h3,{id:"3-\u4f7f\u7528\u6750\u8d28",children:"3. \u4f7f\u7528\u6750\u8d28"}),"\n",(0,s.jsx)(t.p,{children:"\u573a\u666f\u5185\u6dfb\u52a0\u4e00\u4e2asprite, \u4f7f\u7528\u5bf9\u5e94\u7684\u6750\u8d28."}),"\n",(0,s.jsx)(t.h3,{id:"4-\u4f7f\u7528\u811a\u672c\u63a7\u5236",children:"4. \u4f7f\u7528\u811a\u672c\u63a7\u5236"}),"\n",(0,s.jsx)(t.p,{children:"\u8fd9\u91cc\u7684\u6e10\u53d8\u8fc7\u7a0b\uff0c\u6211\u7528tween\u6765\u63a7\u5236\uff0ctween\u7684\u8fdb\u5ea6\u503c\uff0c\u5c31\u662fshader\u4e2d\u7684progress\u503c\u3002\u5177\u4f53\u76ee\u6807\u989c\u8272\uff0c\u4e0d\u80fd\u76f4\u63a5\u5438\u53d6\u76ee\u6807\u56fe\u7247\u91cc\u7684\u989c\u8272\uff0c\u9700\u8981\u6765\u56de\u6311\u4e00\u6311\u770b\u6548\u679c\uff0c\u786e\u5b9a\u4e00\u4e2a\u5408\u9002\u7684\u989c\u8272\u3002"}),"\n",(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:"TintOverlay.ts"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"export default class SpriteTintOverlayEffect extends cc.Component {\n@property(cc.Sprite)\nbgSprite: cc.Sprite = null;\n\nprivate material: cc.Material = null;\nprivate tweenCarrier: { t: number } = null;\nprivate activeTween: cc.Tween<{ t: number }>;\n\nasync onLoad() {\n\tawait this.useTintMaterial();\n}\n\nprivate async useTintMaterial() {\n\t// \u83b7\u53d6\u6750\u8d28\n\tif (!this.material && this.bgSprite) {\n\t\tthis.material = this.bgSprite.getMaterial(0);\n\t\tconsole.log(\"Got material from sprite:\", this.material);\n\t}\n}\n\nonDestroy(): void {\n\tthis.stopTintTween();\n}\n\nonDisable() {\n\tthis.stopTintTween();\n}\n\nprivate stopTintTween() {\n\tif (this.activeTween) {\n\t\ttry { this.activeTween.stop(); } catch (e) { }\n\t\tthis.activeTween = null;\n\t}\n\tif (this.tweenCarrier) {\n\t\ttry { cc.Tween.stopAllByTarget(this.tweenCarrier); } catch (e) { }\n\t\tthis.tweenCarrier = null;\n\t}\n\tif (this.material) {\n\t\t// \u590d\u4f4d\u6548\u679c\uff0c\u907f\u514d\u6b8b\u7559\n\t\ttry { this.material.setProperty('progress', 0); } catch (e) { }\n\t}\n}\n\n// \u5f00\u59cb\u4e00\u6b21\u201c0.3s -> \u505c 5s -> 0.3s\u201d\u53e0\u8272\u52a8\u753b\nplayTint(color: cc.Color, staySec: number = 5, fadeSec: number = 0.3, brightness: number = 1.38) {\n\tif (!this.material) return;\n\n\t// \u8bbe\u7f6e\u53e0\u52a0\u989c\u8272\uff08\u628a cc.Color \u8f6c\u4e3a 0~1\uff09\n\tconst oc = [\n\t\tcolor.r / 255,\n\t\tcolor.g / 255,\n\t\tcolor.b / 255,\n\t\tcolor.a / 255,  // \u7528 A \u5f53\u5f3a\u5ea6\n\t];\n\tthis.material.setProperty('overlayColor', oc);\n\tthis.material.setProperty('brightness', brightness);\n\n\tthis.stopTintTween();\n\tthis.tweenCarrier = { t: 0 };\n\tthis.material.setProperty('progress', 0);\n\n\tthis.activeTween = cc.tween(this.tweenCarrier)\n\t\t.to(fadeSec, { t: 1 }, {\n\t\t\tprogress: (s, e, c, r) => {\n\t\t\t\tconst v = s + (e - s) * r;\n\t\t\t\tthis.material.setProperty('progress', v);\n\t\t\t\treturn v;\n\t\t\t},\n\t\t})\n\t\t.delay(staySec)\n\t\t.to(fadeSec, { t: 0 }, {\n\t\t\tprogress: (s, e, c, r) => {\n\t\t\t\tconst v = s + (e - s) * r;\n\t\t\t\tthis.material.setProperty('progress', v);\n\t\t\t\treturn v;\n\t\t\t},\n\t\t})\n\t\t.call(() => { this.activeTween = null; })\n\t\t.start();\n}\n}\n"})})]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},51909:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/bg1-ae3e8c9fb6da8368f6edc6244d122507.png"},81550:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/bg2-8c6b48a87d547c8ce287dc279fc07ec9.png"},37442:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/tintoverlay1-cbac5e7d04d5f1a72607bdc785db19da.gif"},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var r=n(96540);const s={},i=r.createContext(s);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);