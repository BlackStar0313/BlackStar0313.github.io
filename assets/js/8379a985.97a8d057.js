"use strict";(self.webpackChunk_0313_blog=self.webpackChunk_0313_blog||[]).push([[1463],{6438:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>a,toc:()=>p});const a=JSON.parse('{"id":"Unity/Shader/\u793a\u4f8b\u4e4b\u6cd5\u7ebf\u8d34\u56fe","title":"\u793a\u4f8b\u4e4b\u6cd5\u7ebf\u8d34\u56fe","description":"\u6cd5\u7ebf\u8d34\u56fe","source":"@site/docs/Unity/Shader/\u793a\u4f8b\u4e4b\u6cd5\u7ebf\u8d34\u56fe.md","sourceDirName":"Unity/Shader","slug":"/Unity/Shader/\u793a\u4f8b\u4e4b\u6cd5\u7ebf\u8d34\u56fe","permalink":"/docs/Unity/Shader/\u793a\u4f8b\u4e4b\u6cd5\u7ebf\u8d34\u56fe","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Unity/Shader/\u793a\u4f8b\u4e4b\u6cd5\u7ebf\u8d34\u56fe.md","tags":[],"version":"current","sidebarPosition":1018,"frontMatter":{"title":"\u793a\u4f8b\u4e4b\u6cd5\u7ebf\u8d34\u56fe","date":"2025-03-31T14:41:44.000Z","categories":["Unity","Shader"],"sidebar_position":1018},"sidebar":"tutorialSidebar","previous":{"title":"\u793a\u4f8b\u4e4b\u9ad8\u5149BlinnPong","permalink":"/docs/Unity/Shader/\u793a\u4f8b\u4e4b\u9ad8\u5149BlinnPong"},"next":{"title":"\u793a\u4f8b\u4e4b\u7b80\u5355\u7684PBR","permalink":"/docs/Unity/Shader/\u793a\u4f8b\u4e4b\u7b80\u5355\u7684PBR"}}');var r=e(4848),i=e(8453);const o={title:"\u793a\u4f8b\u4e4b\u6cd5\u7ebf\u8d34\u56fe",date:new Date("2025-03-31T14:41:44.000Z"),categories:["Unity","Shader"],sidebar_position:1018},l=void 0,s={},p=[{value:"\u6cd5\u7ebf\u8d34\u56fe",id:"\u6cd5\u7ebf\u8d34\u56fe",level:2},{value:"\u6cd5\u7ebf\u8d34\u56fe\u7684\u539f\u7406",id:"\u6cd5\u7ebf\u8d34\u56fe\u7684\u539f\u7406",level:2},{value:"\u5173\u952e\u70b9",id:"\u5173\u952e\u70b9",level:2},{value:"TBN\u77e9\u9635\u662f\u7531\u4e09\u4e2a\u5411\u91cf\u7ec4\u6210\u76843\xd73\u77e9\u9635\uff1a",id:"tbn\u77e9\u9635\u662f\u7531\u4e09\u4e2a\u5411\u91cf\u7ec4\u6210\u768433\u77e9\u9635",level:4},{value:"\u526f\u5207\u7ebf\u8ba1\u7b97 (bitangent)",id:"\u526f\u5207\u7ebf\u8ba1\u7b97-bitangent",level:3},{value:"\u7ebf\u6027\u53d8\u6362",id:"\u7ebf\u6027\u53d8\u6362",level:3}];function u(t){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\u6cd5\u7ebf\u8d34\u56fe",children:"\u6cd5\u7ebf\u8d34\u56fe"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"\u793a\u4f8b\u56fe",src:e(7021).A+"",width:"640",height:"368"})}),"\n",(0,r.jsx)(n.p,{children:"\u6cd5\u7ebf\u8d34\u56fe\u662f\u4e00\u79cd\u7528\u4e8e\u6a21\u62df\u51f9\u51f8\u8868\u9762\u7684\u7eb9\u7406\u3002\u5b83\u901a\u8fc7\u5b58\u50a8\u6cd5\u7ebf\u5411\u91cf\u800c\u4e0d\u662f\u989c\u8272\u6765\u63cf\u8ff0\u8868\u9762\u7684\u7ec6\u8282\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["unity\u6587\u6863\u4ecb\u7ecd ",(0,r.jsx)(n.a,{href:"https://docs.unity3d.com/cn/2023.2/Manual/StandardShaderMaterialParameterNormalMap.html",children:"\u6cd5\u7ebf\u8d34\u56fe"})]}),"\n",(0,r.jsx)(n.h2,{id:"\u6cd5\u7ebf\u8d34\u56fe\u7684\u539f\u7406",children:"\u6cd5\u7ebf\u8d34\u56fe\u7684\u539f\u7406"}),"\n",(0,r.jsx)(n.p,{children:"\u6cd5\u7ebf\u8d34\u56fe\u7684\u539f\u7406\u662f\u4f7f\u7528\u6cd5\u7ebf\u5411\u91cf\u6765\u63cf\u8ff0\u8868\u9762\u7684\u51f9\u51f8\u7a0b\u5ea6\u3002\u6cd5\u7ebf\u5411\u91cf\u662f\u4e00\u4e2a\u5355\u4f4d\u5411\u91cf\uff0c\u8868\u793a\u8868\u9762\u7684\u6cd5\u7ebf\u65b9\u5411\u3002\u6cd5\u7ebf\u5411\u91cf\u5728\u8868\u9762\u6cd5\u7ebf\u65b9\u5411\u4e0a\u4e3a1\uff0c\u5728\u5176\u4ed6\u65b9\u5411\u4e0a\u4e3a0\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u5173\u952e\u70b9",children:"\u5173\u952e\u70b9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u901a\u8fc7 UnpackNormal() \u51fd\u6570\u5c06\u6cd5\u7ebf\u8d34\u56fe\u7684\u989c\u8272\u503c\u8f6c\u6362\u4e3a(-1,1)\u8303\u56f4\u7684\u6cd5\u7ebf\u5411\u91cf"}),"\n",(0,r.jsx)(n.li,{children:"\u901a\u8fc7 TBN \u77e9\u9635\u5c06\u6cd5\u7ebf\u4ece\u5207\u7ebf\u7a7a\u95f4\u8f6c\u6362\u5230\u4e16\u754c\u7a7a\u95f4"}),"\n",(0,r.jsx)(n.li,{children:"TBN \u77e9\u9635\u7684\u6784\u5efa"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"tbn\u77e9\u9635\u662f\u7531\u4e09\u4e2a\u5411\u91cf\u7ec4\u6210\u768433\u77e9\u9635",children:"TBN\u77e9\u9635\u662f\u7531\u4e09\u4e2a\u5411\u91cf\u7ec4\u6210\u76843\xd73\u77e9\u9635\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"T (Tangent)\uff1a\u5207\u7ebf\uff0c\u6cbf\u7740\u7eb9\u7406U\u65b9\u5411"}),"\n",(0,r.jsx)(n.li,{children:"B (Bitangent)\uff1a\u526f\u5207\u7ebf\uff0c\u6cbf\u7740\u7eb9\u7406V\u65b9\u5411"}),"\n",(0,r.jsx)(n.li,{children:"N (Normal)\uff1a\u6cd5\u7ebf\uff0c\u5782\u76f4\u4e8e\u8868\u9762"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u526f\u5207\u7ebf\u8ba1\u7b97-bitangent",children:"\u526f\u5207\u7ebf\u8ba1\u7b97 (bitangent)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"float3 bitangent = cross(normal, tangent) * tangent.w;\n"})}),"\n",(0,r.jsx)(n.p,{children:"cross \u53c9\u79ef\u8ba1\u7b97 , \u8ba1\u7b97\u6cd5\u7ebf\u548c\u5207\u7ebf\u53c9\u79ef\uff0c\u5f97\u5230\u5782\u76f4\u4e8e\u6cd5\u7ebf\u548c\u5207\u7ebf\u7684\u5411\u91cf\uff0c\u5373\u526f\u5207\u7ebf"}),"\n",(0,r.jsx)(n.p,{children:"tangent.w \u662f\u5207\u7ebf\u7684\u7b2c\u56db\u4e2a\u5206\u91cf\uff0c\u7528\u4e8e\u533a\u5206\u6b63\u53cd\u9762"}),"\n",(0,r.jsx)(n.h3,{id:"\u7ebf\u6027\u53d8\u6362",children:"\u7ebf\u6027\u53d8\u6362"}),"\n",(0,r.jsxs)(n.p,{children:["mul(normalTS, TBN) \u4f7f\u7528\u76ee\u6807\u7a7a\u95f4\u7684\u57fa\u5411\u91cf(normalTS) \u5c06\u6cd5\u7ebf\u4ece\u5207\u7ebf\u7a7a\u95f4\u8f6c\u6362\u5230\u4e16\u754c\u7a7a\u95f4,",(0,r.jsx)(n.br,{}),"\n","\u7528\u884c\u5411\u91cf\u4e58\u4ee5\u77e9\u9635\uff0c\u5f97\u5230\u7ed3\u679c\u5411\u91cf\uff0c\u7b49\u540c\u4e8e\nnormalWS = mul(transpose(TBN), normalTS); // \u53d8\u6362\u77e9\u9635\u5e94\u8be5\u662fTBN\u7684\u8f6c\u7f6e\u77e9\u9635."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'Shader "Custom/URPLitNormalMapping"\n{\n    Properties\n    {\n      _MainTex("Texture", 2D) = "white" {}\n\t  [Normal]_NormalMap("Normal Map", 2D) = "bump" {}\n\t  _NormalStrength("Normal Strength", Range(0, 2)) = 1\n\t  _BaseColor("Base Color", Color) = (1,1,1,1)\n\t  _AmbientStrength("Ambient Strength", Range(0, 1)) = 0.1\n\t  _SpecularColor("Specular Color", Color) = (1,1,1,1)\n\t  _Glossiness("Glossiness", Range(0, 100)) = 30\n    }\n\n    SubShader\n    {\n        Tags {\n\t\t\t"RenderType"="Opaque"\n\t\t\t"RenderPipeline"="UniversalPipeline"\n\t\t}\n\n\t\tpass\n\t\t{\n\t\t\tHLSLPROGRAM\n\t\t\t#pragma vertex vert\n\t\t\t#pragma fragment frag \n\n\t\t\t#include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"\n\t\t\t#include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl"\n\n\t\t\tTEXTURE2D(_MainTex);\n\t\t\tSAMPLER(sampler_MainTex);\n\t\t\tTEXTURE2D(_NormalMap);\n\t\t\tSAMPLER(sampler_NormalMap);\n\n\t\t\tCBUFFER_START(UnityPerMaterial)\n\t\t\t\tfloat4 _MainTex_ST;\n\t\t\t\tfloat4 _NormalMap_ST;\n\t\t\t\tfloat _NormalStrength;\n\t\t\t\tfloat4 _BaseColor;\n\t\t\t\tfloat _AmbientStrength;\n\t\t\t\tfloat4 _SpecularColor;\n\t\t\t\tfloat _Glossiness;\n\t\t\tCBUFFER_END\n\t\t\t\n\t\t\tstruct Attributes\n\t\t\t{\n\t\t\t\tfloat4 positionOS : POSITION;\n\t\t\t\tfloat3 normalOS : NORMAL;\n\t\t\t\tfloat4 tangentOS : TANGENT;\n\t\t\t\tfloat2 uv : TEXCOORD0;\n\t\t\t};\n\n\t\t\tstruct Varyings\n\t\t\t{\n\t\t\t\tfloat4 positionCS : SV_POSITION;\n\t\t\t\tfloat2 uv : TEXCOORD0;\n\t\t\t\tfloat3 positionWS : TEXCOORD1;\n\t\t\t\tfloat3 normalWS : NORMAL;\n\t\t\t\tfloat4 tangentWS : TEXCOORD2;\n\t\t\t\tfloat3 bitangentWS : TEXCOORD3;\n\t\t\t};\n\n\t\t\tVaryings vert(Attributes input)\n\t\t\t{\n\t\t\t\tVaryings output;\n\t\t\t\toutput.positionCS = TransformObjectToHClip(input.positionOS.xyz);\n\t\t\t\toutput.positionWS = TransformObjectToWorld(input.positionOS.xyz);\n\t\t\t\toutput.uv = TRANSFORM_TEX(input.uv, _MainTex);\n\t\t\t\t\n\n\t\t\t\t// \u8ba1\u7b97TBN \u77e9\u9635\n\t\t\t\toutput.normalWS = TransformObjectToWorldNormal(input.normalOS);\n\t\t\t\toutput.tangentWS = float4(TransformObjectToWorldDir(input.tangentOS.xyz), input.tangentOS.w);\n\t\t\t\toutput.bitangentWS = cross(output.normalWS, output.tangentWS.xyz) * input.tangentOS.w;\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\thalf4 frag(Varyings input) : SV_TARGET\n\t\t\t{\n\n\t\t\t\thalf4 texColor = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, input.uv);\n\t\t\t\thalf3 albedo = texColor.rgb * _BaseColor.rgb;\n\n\t\t\t\t// \u4ece\u6cd5\u7ebf\u8d34\u56fe\u83b7\u53d6\u6cd5\u7ebf\n\t\t\t\thalf4 normalMap = SAMPLE_TEXTURE2D(_NormalMap, sampler_NormalMap, input.uv);\n\t\t\t\thalf3 normalTS = UnpackNormal(normalMap);  // \u89e3\u7801\u6cd5\u7ebf \u51fd\u6570\u5c06\u989c\u8272\u503c\u8f6c\u6362\u4e3a(-1,1)\u8303\u56f4\u7684\u6cd5\u7ebf\u5411\u91cf\n\t\t\t\tnormalTS.xy *= _NormalStrength;\n\t\t\t\tnormalTS = normalize(normalTS);\n\n\t\t\t\t// \u6784\u5efaTBN\u77e9\u9635\n\t\t\t\tfloat3x3 TBN = float3x3(\n\t\t\t\t\tnormalize(input.tangentWS.xyz),\n\t\t\t\t\tnormalize(input.bitangentWS),\n\t\t\t\t\tnormalize(input.normalWS)\n\t\t\t\t);\n\t\t\t\t//\u4ece\u5207\u7ebf\u7a7a\u95f4\u8f6c\u6362\u5230\u4e16\u754c\u7a7a\u95f4\n\t\t\t\thalf3 normalWS = mul(normalTS, TBN);\n\n\n                Light mainLight = GetMainLight();\n\n                half3 ambient = albedo * _AmbientStrength;\n\n                //Lambert diffuse \n                float NdotL =max(0, dot(normalWS, mainLight.direction)) ;\n                half3 diffuse = albedo * mainLight.color * NdotL;\n                 \n                //Blinn-Phong specular\n                //GetWorldSpaceViewDir(input.positionWS) \u8fd4\u56de\u4ece\u9876\u70b9\u5230\u6444\u50cf\u673a\u7684\u5411\u91cf\n                float3 viewDir = normalize(GetWorldSpaceViewDir(input.positionWS));\n                // \u534a\u89d2\u5411\u91cf\uff0c\u521a\u597d\u662f\u4f4d\u4e8e\u5149\u7167\u65b9\u5411\u548c\u89c6\u7ebf\u65b9\u5411\u7684\u4e2d\u95f4,\u6570\u5b66\u4e0a\u662f\uff0c\u4e24\u4e2a\u5411\u91cf\u76f8\u52a0\uff0c\u7b49\u4e8e\u7531\u4e24\u4e2a\u5411\u91cf\u7ec4\u6210\u7684\u83f1\u5f62\u7684\u5bf9\u89d2\u7ebf\u3002\n                float3 halfVector = normalize(mainLight.direction + viewDir);\n                float NdotH = max(0, dot(normalWS, halfVector));\n                half3 specular = _SpecularColor.rgb * mainLight.color * pow(NdotH, _Glossiness);\n\n                //\u7ec4\u5408\u73af\u5883\u5149\uff0c\u6f2b\u53cd\u5c04\u548c\u9ad8\u5149\n                half3 color = ambient + diffuse + specular;\n                return half4(color, 1.0);\n\t\t\t}\n\t\t\tENDHLSL\n\t\t}\n    }\n}\n'})})]})}function c(t={}){const{wrapper:n}={...(0,i.R)(),...t.components};return n?(0,r.jsx)(n,{...t,children:(0,r.jsx)(u,{...t})}):u(t)}},7021:(t,n,e)=>{e.d(n,{A:()=>a});const a=e.p+"assets/images/normalMapping-9b55e9222b42a5fa1cb19e3a32992373.gif"},8453:(t,n,e)=>{e.d(n,{R:()=>o,x:()=>l});var a=e(6540);const r={},i=a.createContext(r);function o(t){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function l(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:o(t.components),a.createElement(i.Provider,{value:n},t.children)}}}]);