<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-游戏技术/2d游戏战斗中碰撞检测优化-空间划分" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">游戏战斗中碰撞检测优化-空间分割 | Liu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blackstar0313.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blackstar0313.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blackstar0313.github.io/docs/游戏技术/2d游戏战斗中碰撞检测优化-空间划分"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="游戏战斗中碰撞检测优化-空间分割 | Liu"><meta data-rh="true" name="description" content="问题"><meta data-rh="true" property="og:description" content="问题"><link data-rh="true" rel="icon" href="/img/head.jpg"><link data-rh="true" rel="canonical" href="https://blackstar0313.github.io/docs/游戏技术/2d游戏战斗中碰撞检测优化-空间划分"><link data-rh="true" rel="alternate" href="https://blackstar0313.github.io/docs/游戏技术/2d游戏战斗中碰撞检测优化-空间划分" hreflang="en"><link data-rh="true" rel="alternate" href="https://blackstar0313.github.io/zh-Hans/docs/游戏技术/2d游戏战斗中碰撞检测优化-空间划分" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://blackstar0313.github.io/docs/游戏技术/2d游戏战斗中碰撞检测优化-空间划分" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Liu RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Liu Atom Feed"><link rel="stylesheet" href="/assets/css/styles.e96830d2.css">
<script src="/assets/js/runtime~main.1173b3d2.js" defer="defer"></script>
<script src="/assets/js/main.0e8f933b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">0313的博客</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Intro">Tech</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/BlackStar0313" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/游戏技术">游戏技术</a><button aria-label="Collapse sidebar category &#x27;游戏技术&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/游戏技术/2d游戏战斗中碰撞检测优化-空间划分">游戏战斗中碰撞检测优化-空间分  割</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/动效研究">动效研究</a><button aria-label="Expand sidebar category &#x27;动效研究&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/blog相关">Blog相关</a><button aria-label="Expand sidebar category &#x27;Blog相关&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/unity">Unity</a><button aria-label="Expand sidebar category &#x27;Unity&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/工具ai">工具&amp;AI</a><button aria-label="Expand sidebar category &#x27;工具&amp;AI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/各种诡异问题">各种诡异问题</a><button aria-label="Expand sidebar category &#x27;各种诡异问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/c">C#</a><button aria-label="Expand sidebar category &#x27;C#&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/游戏技术"><span itemprop="name">游戏技术</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">游戏战斗中碰撞检测优化-空间分割</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>游戏战斗中碰撞检测优化-空间分割</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="问题">问题<a href="#问题" class="hash-link" aria-label="Direct link to 问题" title="Direct link to 问题">​</a></h2>
<p>在开发类似雷电的游戏中，小人会发出子弹，并对随机出的小人时时进行碰撞检测。遇到的性能问题是：</p>
<ul>
<li>屏幕自上而下按轮数先后出一百个小人</li>
<li>每个小人都可以对玩家发出子弹</li>
<li>玩家可以向敌人发出子弹，可以同时拥有十几个武器</li>
<li>拥有不同的武器，发出的子弹形状和形态都不一样</li>
<li>同屏可能会出现几百个敌人和几百个子弹</li>
<li>他们的位置每帧都在移动，每帧都需要进行子弹和角色的碰撞检测</li>
</ul>
<p>这导致敌人多时，每帧计算过多，CPU 占用卡到不能动。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案">解决方案<a href="#解决方案" class="hash-link" aria-label="Direct link to 解决方案" title="Direct link to 解决方案">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-渲染优化">1. 渲染优化<a href="#1-渲染优化" class="hash-link" aria-label="Direct link to 1. 渲染优化" title="Direct link to 1. 渲染优化">​</a></h3>
<ul>
<li>骨骼动画合并到一个动画里</li>
<li>使用一张纹理，减少纹理切换</li>
<li>使用 cocos 的 <strong>PRIVATE_CACHE</strong> 模式并开启动画合批降低 drawcall</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-碰撞检测优化">2. 碰撞检测优化<a href="#2-碰撞检测优化" class="hash-link" aria-label="Direct link to 2. 碰撞检测优化" title="Direct link to 2. 碰撞检测优化">​</a></h3>
<ul>
<li>不使用物理引擎，避免物理引擎中冗余的计算</li>
<li>对不同的子弹，进行不同的碰撞计算<!-- -->
<ul>
<li>圆和矩形碰撞</li>
<li>点和矩形碰撞</li>
<li>避免使用多边形碰撞等等</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-碰撞 检测前空间划分">3. 碰撞检测前空间划分<a href="#3-碰撞检测前空间划分" class="hash-link" aria-label="Direct link to 3. 碰撞检测前空间划分" title="Direct link to 3. 碰撞检测前空间划分">​</a></h3>
<p>同屏过多的小人，一颗子弹每帧会遍历所有敌人，挨个进行碰撞计算会依然会卡顿。当一颗子弹发出，没必要对所有敌人进行检测，只需要对他周围可能会碰到的敌人去检测，会大大提高效率。需要对数量众多的敌人进行分区域，通过子弹所在区域只对该区域的敌人去检测。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="空间划分">空间划分<a href="#空间划分" class="hash-link" aria-label="Direct link to 空间划分" title="Direct link to 空间划分">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-网格划分">1. 网格划分<a href="#1-网格划分" class="hash-link" aria-label="Direct link to 1. 网格划分" title="Direct link to 1. 网格划分">​</a></h3>
<p>均匀网格划分，根据子弹的矩形大小，为网格格子大小，对整个地图划分网格。</p>
<div style="text-align:center"><img src="./img/1.png" width="200"></div>
<p><img decoding="async" loading="lazy" alt="test|200" src="/assets/images/1-2fe1dcba99666359aff4698d2188a8aa.png" width="193" height="172" class="img_ev3q"></p>
<p>这样就可以根据子弹和怪的坐标，确定是否在同一个格子中，来筛选出该判断的小怪实例，测试发现性能提升不少。但是不稳定，只能是特别简单的情况性能才会有明显优势。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="存在问题">存在问题：<a href="#存在问题" class="hash-link" aria-label="Direct link to 存在问题：" title="Direct link to 存在问题：">​</a></h4>
<ol>
<li>子弹和小怪是存在体积的，不是一个点，一个小怪可能在多个格子中</li>
<li>子弹存在旋转，且子弹的形态不同：<!-- -->
<ul>
<li>有小矩形小子弹</li>
<li>扇形的喷火器</li>
<li>激光子弹这种贯穿屏幕的</li>
</ul>
</li>
</ol>
<p>这使网格大小有可能一个屏幕只能会有 1 个存在，约等于没提升。</p>
<p>针对上面的问题，尝试通过这种方式优化：
<img decoding="async" loading="lazy" alt="优化示意图" src="/assets/images/2-4e1938bed5ea19db8cfb4792cf828ee6.png" width="379" height="215" class="img_ev3q"></p>
<p>将格子偏移一定距离，也就是扩大一定格子的大小，结果有所提升，但是并不好。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-四叉树">2. 四叉树<a href="#2-四叉树" class="hash-link" aria-label="Direct link to 2. 四叉树" title="Direct link to 2. 四叉树">​</a></h3>
<p><img decoding="async" loading="lazy" alt="四叉树示意图1" src="data:image/png;base64,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" width="493" height="438" class="img_ev3q">
<img decoding="async" loading="lazy" alt="四叉树示意图2" src="/assets/images/4-d81c19fb4ec30118391faa8740b81ab5.png" width="317" height="315" class="img_ev3q"></p>
<p>开始尝试使用四叉树，对整个地图做动态分区。这样效率大大提升，基本不会出现严重卡顿的情况了。</p>
<p>2d 空间四叉树，对一个平面进行四等分，再对每一个分块再进行四等分，直到该区域内所有节点数量达到预先设置的阈值。基础思想其实就是 2 分法。</p>
<p>因为用的 cocos 引擎，所以找了一个四叉树的 js 库：
<a href="https://github.com/timohausmann/quadtree-js" target="_blank" rel="noopener noreferrer">https://github.com/timohausmann/quadtree-js</a></p>
<p>可以动态检索与被检查物体在同一范围内的其他小怪。从下面的图看到，200 个小怪只需要检测个位数的小怪来完成预筛选：
<a href="https://timohausmann.de/quadtree.js/dynamic.html" target="_blank" rel="noopener noreferrer">https://timohausmann.de/quadtree.js/dynamic.html</a></p>
<p><img decoding="async" loading="lazy" alt="性能对比图" src="/assets/images/5-d4412821126cf1109bd1645147b96cae.jpg" width="1582" height="1466" class="img_ev3q"></p>
<p>这个库提供了最基础的四叉树构建，和动态添加功能：</p>
<ul>
<li>可以设置树的最大深度</li>
<li>树节点可包含的 node 的阈值</li>
<li>代码很少，很精炼</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="缺点">缺点：<a href="#缺点" class="hash-link" aria-label="Direct link to 缺点：" title="Direct link to 缺点：">​</a></h4>
<ol>
<li>只能动态添加，不能动态删除</li>
<li>想要动态删除和添加，需要每帧开始时，重新构建地图上所有怪物的四叉树</li>
<li>对象只能是矩形</li>
</ol>
<p>由于项目时间的限制，没有过多时间去这个库进行针对性修改逻辑，但是性能上提升很多，基本够用。</p>
<p><img decoding="async" loading="lazy" alt="示例图1" src="/assets/images/6-886728d94824d20fff2a57304cf75793.jpg" width="756" height="1394" class="img_ev3q"><br>
<img decoding="async" loading="lazy" alt="示例图2" src="/assets/images/7-70aa354e6a7ae4e93ea283152d62d31e.jpg" width="740" height="1452" class="img_ev3q"></p>
<p>还有很多其他的空间划分，没再过多研究。除了对碰撞检测进行优化，还可以引用在视锥剔除，比如游戏中的大地图，不在某一范围的可以不显示，或者忽略细节，3d 游戏中，摄像机中物体被其他物体挡住后可以不渲染来提升渲染效率。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ol>
<li><a href="https://blog.csdn.net/liran2019/article/details/106966794" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/liran2019/article/details/106966794</a></li>
<li><a href="https://www.cnblogs.com/KillerAery/p/10878367.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/KillerAery/p/10878367.html</a></li>
<li><a href="https://forum.cocos.org/t/topic/95573" target="_blank" rel="noopener noreferrer">https://forum.cocos.org/t/topic/95573</a></li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/技术">技术</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/游戏优化">游戏优化</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/碰撞检测">碰撞检测</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/空间分割">空间分割</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/游戏技术/2d游戏战斗中碰撞检测优化-空间划分.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/游戏技术"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">游戏技术</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/动效研究"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">动效研究</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#问题" class="table-of-contents__link toc-highlight">问题</a></li><li><a href="#解决方案" class="table-of-contents__link toc-highlight">解决方案</a><ul><li><a href="#1-渲染优化" class="table-of-contents__link toc-highlight">1. 渲染优化</a></li><li><a href="#2-碰撞检测优化" class="table-of-contents__link toc-highlight">2. 碰撞检测优化</a></li><li><a href="#3-碰撞检测前空间划分" class="table-of-contents__link toc-highlight">3. 碰撞检测前空间划分</a></li></ul></li><li><a href="#空间划分" class="table-of-contents__link toc-highlight">空间划分</a><ul><li><a href="#1-网格划分" class="table-of-contents__link toc-highlight">1. 网格划分</a></li><li><a href="#2-四叉树" class="table-of-contents__link toc-highlight">2. 四叉树</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © From 2024 - 2025 ❤ Liu</div></div></div></footer></div>
</body>
</html>